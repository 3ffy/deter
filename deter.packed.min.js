/* deter - version: 3.0 - author: 3ffy (Aur√©lien Gy) - aureliengy@gmail.com - http://www.aureliengy.com - licence: BSD 3-Clause Licence (@see licence file or https://raw.githubusercontent.com/3ffy/deter/master/LICENSE). Note that the plugins "JQuery.Identicon5" by Francis Shanahan (http://archive.plugins.jquery.com/project/identicon5) and "JQuery.MD5" by Gabriele Romanato (http://blog.gabrieleromanato.com) are separated project and get their own licence. */
!function(e){e.md5=function(e){function t(e,t){return e<<t|e>>>32-t}function r(e,t){var r,a,s,n,o
return s=2147483648&e,n=2147483648&t,r=1073741824&e,a=1073741824&t,o=(1073741823&e)+(1073741823&t),r&a?2147483648^o^s^n:r|a?1073741824&o?3221225472^o^s^n:1073741824^o^s^n:o^s^n}function a(e,t,r){return e&t|~e&r}function s(e,t,r){return e&r|t&~r}function n(e,t,r){return e^t^r}function o(e,t,r){return t^(e|~r)}function i(e,s,n,o,i,c,b){return e=r(e,r(r(a(s,n,o),i),b)),r(t(e,c),s)}function c(e,a,n,o,i,c,b){return e=r(e,r(r(s(a,n,o),i),b)),r(t(e,c),a)}function b(e,a,s,o,i,c,b){return e=r(e,r(r(n(a,s,o),i),b)),r(t(e,c),a)}function d(e,a,s,n,i,c,b){return e=r(e,r(r(o(a,s,n),i),b)),r(t(e,c),a)}function u(e){for(var t,r=e.length,a=r+8,s=(a-a%64)/64,n=16*(s+1),o=Array(n-1),i=0,c=0;r>c;)t=(c-c%4)/4,i=c%4*8,o[t]=o[t]|e.charCodeAt(c)<<i,c++
return t=(c-c%4)/4,i=c%4*8,o[t]=o[t]|128<<i,o[n-2]=r<<3,o[n-1]=r>>>29,o}function l(e){var t,r,a="",s=""
for(r=0;3>=r;r++)t=e>>>8*r&255,s="0"+t.toString(16),a+=s.substr(s.length-2,2)
return a}function h(e){e=e.replace(/\r\n/g,"\n")
for(var t="",r=0;r<e.length;r++){var a=e.charCodeAt(r)
128>a?t+=String.fromCharCode(a):a>127&&2048>a?(t+=String.fromCharCode(a>>6|192),t+=String.fromCharCode(63&a|128)):(t+=String.fromCharCode(a>>12|224),t+=String.fromCharCode(a>>6&63|128),t+=String.fromCharCode(63&a|128))}return t}var g,f,v,p,x,m,y,k,w,C=[],z=7,M=12,T=17,R=22,I=5,S=9,$=14,L=20,j=4,D=11,X=16,q=23,A=6,F=10,E=15,P=21
for(e=h(e),C=u(e),m=1732584193,y=4023233417,k=2562383102,w=271733878,g=0;g<C.length;g+=16)f=m,v=y,p=k,x=w,m=i(m,y,k,w,C[g+0],z,3614090360),w=i(w,m,y,k,C[g+1],M,3905402710),k=i(k,w,m,y,C[g+2],T,606105819),y=i(y,k,w,m,C[g+3],R,3250441966),m=i(m,y,k,w,C[g+4],z,4118548399),w=i(w,m,y,k,C[g+5],M,1200080426),k=i(k,w,m,y,C[g+6],T,2821735955),y=i(y,k,w,m,C[g+7],R,4249261313),m=i(m,y,k,w,C[g+8],z,1770035416),w=i(w,m,y,k,C[g+9],M,2336552879),k=i(k,w,m,y,C[g+10],T,4294925233),y=i(y,k,w,m,C[g+11],R,2304563134),m=i(m,y,k,w,C[g+12],z,1804603682),w=i(w,m,y,k,C[g+13],M,4254626195),k=i(k,w,m,y,C[g+14],T,2792965006),y=i(y,k,w,m,C[g+15],R,1236535329),m=c(m,y,k,w,C[g+1],I,4129170786),w=c(w,m,y,k,C[g+6],S,3225465664),k=c(k,w,m,y,C[g+11],$,643717713),y=c(y,k,w,m,C[g+0],L,3921069994),m=c(m,y,k,w,C[g+5],I,3593408605),w=c(w,m,y,k,C[g+10],S,38016083),k=c(k,w,m,y,C[g+15],$,3634488961),y=c(y,k,w,m,C[g+4],L,3889429448),m=c(m,y,k,w,C[g+9],I,568446438),w=c(w,m,y,k,C[g+14],S,3275163606),k=c(k,w,m,y,C[g+3],$,4107603335),y=c(y,k,w,m,C[g+8],L,1163531501),m=c(m,y,k,w,C[g+13],I,2850285829),w=c(w,m,y,k,C[g+2],S,4243563512),k=c(k,w,m,y,C[g+7],$,1735328473),y=c(y,k,w,m,C[g+12],L,2368359562),m=b(m,y,k,w,C[g+5],j,4294588738),w=b(w,m,y,k,C[g+8],D,2272392833),k=b(k,w,m,y,C[g+11],X,1839030562),y=b(y,k,w,m,C[g+14],q,4259657740),m=b(m,y,k,w,C[g+1],j,2763975236),w=b(w,m,y,k,C[g+4],D,1272893353),k=b(k,w,m,y,C[g+7],X,4139469664),y=b(y,k,w,m,C[g+10],q,3200236656),m=b(m,y,k,w,C[g+13],j,681279174),w=b(w,m,y,k,C[g+0],D,3936430074),k=b(k,w,m,y,C[g+3],X,3572445317),y=b(y,k,w,m,C[g+6],q,76029189),m=b(m,y,k,w,C[g+9],j,3654602809),w=b(w,m,y,k,C[g+12],D,3873151461),k=b(k,w,m,y,C[g+15],X,530742520),y=b(y,k,w,m,C[g+2],q,3299628645),m=d(m,y,k,w,C[g+0],A,4096336452),w=d(w,m,y,k,C[g+7],F,1126891415),k=d(k,w,m,y,C[g+14],E,2878612391),y=d(y,k,w,m,C[g+5],P,4237533241),m=d(m,y,k,w,C[g+12],A,1700485571),w=d(w,m,y,k,C[g+3],F,2399980690),k=d(k,w,m,y,C[g+10],E,4293915773),y=d(y,k,w,m,C[g+1],P,2240044497),m=d(m,y,k,w,C[g+8],A,1873313359),w=d(w,m,y,k,C[g+15],F,4264355552),k=d(k,w,m,y,C[g+6],E,2734768916),y=d(y,k,w,m,C[g+13],P,1309151649),m=d(m,y,k,w,C[g+4],A,4149444226),w=d(w,m,y,k,C[g+11],F,3174756917),k=d(k,w,m,y,C[g+2],E,718787259),y=d(y,k,w,m,C[g+9],P,3951481745),m=r(m,f),y=r(y,v),k=r(k,p),w=r(w,x)
var Q=l(m)+l(y)+l(k)+l(w)
return Q.toLowerCase()},e.fn.identicon5=function(t){settings=jQuery.extend({rotate:!0,size:32},t)
var r=function(e,t){if(t.length>=2){e.beginPath(),e.moveTo(t[0],t[1])
for(var r=2;r<t.length;r++)e.lineTo(t[r],t[r+1]),r++
e.fill()}},a=function(e,t){switch(e){case 0:e=[.5,1,1,0,1,1]
break
case 1:e=[.5,0,1,0,.5,1,0,1]
break
case 2:e=[.5,0,1,0,1,1,.5,1,1,.5]
break
case 3:e=[0,.5,.5,0,1,.5,.5,1,.5,.5]
break
case 4:e=[0,.5,1,0,1,1,0,1,1,.5]
break
case 5:e=[1,0,1,1,.5,1,1,.5,.5,.5]
break
case 6:e=[0,0,1,0,1,.5,0,0,.5,1,0,1]
break
case 7:e=[0,0,.5,0,1,.5,.5,1,0,1,.5,.5]
break
case 8:e=[.5,0,.5,.5,1,.5,1,1,.5,1,.5,.5,0,.5]
break
case 9:e=[0,0,1,0,.5,.5,1,.5,.5,1,.5,.5,0,1]
break
case 10:e=[0,.5,.5,1,1,.5,.5,0,1,0,1,1,0,1]
break
case 11:e=[.5,0,1,0,1,1,.5,1,1,.75,.5,.5,1,.25]
break
case 12:e=[0,.5,.5,0,.5,.5,1,0,1,.5,.5,1,.5,.5,0,1]
break
case 13:e=[0,0,1,0,1,1,0,1,1,.5,.5,.25,.5,.75,0,.5,.5,.25]
break
case 14:e=[0,.5,.5,.5,.5,0,1,0,.5,.5,1,.5,.5,1,.5,.5,0,1]
break
default:e=[0,0,1,0,.5,.5,.5,0,0,.5,1,.5,.5,1,.5,.5,0,1]}for(var r=0;r<e.length;r++)e[r]=e[r]*t
return e},s=function(e,t){var s,n=t/5,o=n/2,i=0,c=0
e.strokeRect(0,0,n,n)
for(var b=0;15>b;b++){s=a(b,n),e.save(),e.translate(o+i*n,o+c*n)
for(var d=0;d<s.length;d++)s[d]-=o
r(e,s),e.strokeRect(-o,-o,n,n),e.restore(),i>=4?(i=0,c++):i++}},n=function(e,t,a,s,n,o,i){var c=i/2
e.save(),e.translate(a,s),e.rotate(o*Math.PI/180),e.save(),e.translate(c,c)
for(var b=[],d=0;d<t.length;d++)b[d]=t[d]-c
e.rotate(n),r(e,b),e.restore(),e.restore()},o=function(e,t){switch(e){case 0:e=[]
break
case 1:e=[0,0,1,0,1,1,0,1]
break
case 2:e=[.5,0,1,.5,.5,1,0,.5]
break
case 3:e=[0,0,1,0,1,1,0,1,0,.5,.5,1,1,.5,.5,0,0,.5]
break
case 4:e=[.25,0,.75,0,.5,.5,1,.25,1,.75,.5,.5,.75,1,.25,1,.5,.5,0,.75,0,.25,.5,.5]
break
case 5:e=[0,0,.5,.25,1,0,.75,.5,1,1,.5,.75,0,1,.25,.5]
break
case 6:e=[.33,.33,.67,.33,.67,.67,.33,.67]
break
case 7:e=[0,0,.33,0,.33,.33,.66,.33,.67,0,1,0,1,.33,.67,.33,.67,.67,1,.67,1,1,.67,1,.67,.67,.33,.67,.33,1,0,1,0,.67,.33,.67,.33,.33,0,.33]
break
default:e=[0,0,1,0,.5,.5,.5,0,0,.5,1,.5,.5,1,.5,.5,0,1]}for(var r=0;r<e.length;r++)e[r]=e[r]*t
return e},i=function(e,t,r,s){var i=parseInt(t.substr(0,1),16),c=parseInt(t.substr(1,1),16),b=7&parseInt(t.substr(2,1),16),d=Math.PI/2,u=d*(3&parseInt(t.substr(3,1),16)),l=d*(3&parseInt(t.substr(4,1),16)),h=parseInt(t.substr(5,1),16)%2,g=parseInt(t.substr(6,2),16),f=parseInt(t.substr(8,2),16),v=parseInt(t.substr(10,2),16),p=parseInt(t.substr(12,2),16),x=parseInt(t.substr(14,2),16),m=parseInt(t.substr(16,2),16),y=r/3,k=r,w=a(i,y)
e.fillStyle="rgb("+g+","+f+","+v+")",s===!1&&(u=0),n(e,w,0,0,u,0,y),n(e,w,k,0,u,90,y),n(e,w,k,k,u,180,y),n(e,w,0,k,u,270,y),s===!1&&(l=0)
var C=a(c,y)
e.fillStyle="rgb("+p+","+x+","+m+")",n(e,C,0,y,l,0,y),n(e,C,2*y,0,l,90,y),n(e,C,3*y,2*y,l,180,y),n(e,C,y,3*y,l,270,y)
var z=o(b,y)
e.fillStyle=h>0&&(Math.abs(g-p)>127||Math.abs(f-x)>127||Math.abs(v-m)>127)?"rgb("+p+","+x+","+m+")":"rgb("+g+","+f+","+v+")",n(e,z,y,y,0,0,y)}
return this.each(function(){var t=e(this).html(),r=document.createElement("canvas")
if(r.getContext){r.width=settings.size,r.height=settings.size
var a=r.getContext("2d")
"test"===t?s(a,settings.size):i(a,t,settings.size,settings.rotate),e(this).html(""),e(this).append(r)}})}
var t=document.createElement("canvas"),r=t.getContext?!0:!1,a={}
a.boxTitle="If this picture is not the one you use to see, your password is misspelled."
var s=function(t,r){var a={}
a.md5=e.md5(t),a.hexRaw=a.md5.substr(0,6),a.hex="#"+a.hexRaw,a.rgbRaw=e.hexToRgb(a.hexRaw,!0),a.rgb="rgb("+a.rgbRaw.r+", "+a.rgbRaw.g+", "+a.rgbRaw.b+")"
var s="number"==typeof r?r:1
return a.rgbaRaw=a.rgbRaw,a.rgbaRaw.a=s,a.rgba="rgba("+a.rgbaRaw.r+", "+a.rgbaRaw.g+", "+a.rgbaRaw.b+", "+a.rgbaRaw.a+")",a},n=function(t){var r=t.data,a="function"==typeof r.getContent?r.getContent.call(this):e(this).val(),s=e.strToColor(a,r.opacity,r.sequence)
r.callback.call(this,r,s,a)},o=function(t,r,a){if($elem=e("string"==typeof t.target?t.target:this),""==a)$elem.css("-webkit-box-shadow","").css("-moz-box-shadow","").css("box-shadow","").css("border-color","")
else{var s="inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px "+r.rgba
$elem.css("-webkit-box-shadow",s).css("-moz-box-shadow",s).css("box-shadow",s).css("border-color",r.hex)}},i=function(t,r,a){if($elem=e("string"==typeof t.target?t.target:this),$elem.css("background-color",""==a?"":r.hex),"complementary"==t.textColorMode){var s=e.getComplementaryColor(r.rgbRaw)
$elem.css("color","rgb("+s.r+","+s.g+","+s.b+")")}else if("monochrome"==t.textColorMode){var n=e.getFurtherColor(r.rgbRaw)
$elem.css("color","rgb("+n.r+","+n.g+","+n.b+")")}},c=function(t,r,a){var s=e(this).siblings("span.deter-fingerprint")
s.css("background-color",""==a?"":r.hex)},b=function(t,r,a){var s=e(this).siblings("span.deter-fingerprint")
""==a?s.text(""):s.identicon(r.md5,r.hex,{rotate:!0,size:t.canevasSize})}
e.extend({deter:a,hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i
e=e.replace(t,function(e,t,r,a){return t+t+r+r+a+a})
var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e)
return r?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:null},rgbToXyz:function(e){var t={},r=parseFloat(e.r/255),a=parseFloat(e.g/255),s=parseFloat(e.b/255)
return r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,a=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92,s=s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92,r=100*r,a=100*a,s=100*s,t.x=.4124*r+.3576*a+.1805*s,t.y=.2126*r+.7152*a+.0722*s,t.z=.0193*r+.1192*a+.9505*s,t},xyzToLab:function(e){var t={},r=e.x/95.047,a=e.y/100,s=e.z/108.883
return r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,s=s>.008856?Math.pow(s,1/3):7.787*s+16/116,t.l=116*a-16,t.a=500*(r-a),t.b=200*(a-s),t},getComplementaryColor:function(e,t){var r={}
return r.r=Math.abs(255-e.r),r.g=Math.abs(1==t?255-(e.r+e.b)/2:255-e.g),r.b=Math.abs(255-e.b),r},getClosestColor:function(t,r,s){"object"!=typeof r&&(rgbSeed1={r:0,g:0,b:0}),"object"!=typeof s&&(s={r:255,g:255,b:255})
var n=e.rgbToXyz(a.rgbRaw),o=e.xyzToLab(n),i=e.rgbToXyz(r),c=e.xyzToLab(i),b=e.rgbToXyz(s),d=e.xyzToLab(b),u=Math.abs(c.l-o.l)+Math.abs(c.a-o.a)+Math.abs(c.b-o.b),l=Math.abs(d.l-o.l)+Math.abs(d.a-o.a)+Math.abs(d.b-o.b)
return l>=u?r:s},getFurtherColor:function(t,r,a){"object"!=typeof r&&(r={r:0,g:0,b:0}),"object"!=typeof a&&(a={r:255,g:255,b:255})
var s=e.rgbToXyz(t),n=e.xyzToLab(s),o=e.rgbToXyz(r),i=e.xyzToLab(o),c=e.rgbToXyz(a),b=e.xyzToLab(c),d=Math.abs(i.l-n.l)+Math.abs(i.a-n.a)+Math.abs(i.b-n.b),u=Math.abs(b.l-n.l)+Math.abs(b.a-n.a)+Math.abs(b.b-n.b)
return d>u?r:a},strToColor:function(e,t,r){var a
if(r!==!0)a=s(e,t)
else{a=[]
var n,o,i=e.length
for(n=0;i>n;n++)o=e.substr(0,n+1),a.push(s(o,t))}return a}}),e.fn.deter=function(t,a){var s,d=e.extend({sequence:!1,opacity:1,canevasSize:"auto",addDeterExtraMarkups:!0,getContent:null,events:"keyup",selectorDelegated:null,selectorDescendant:null,addClass:"",textColorMode:"default",target:null},a)
if("function"==typeof t?(s="custom",d.sequence=!1):s="string"==typeof t&&"default"!=t?t:"box-identicon","box-identicon"==s&&0==r&&(s="box-color"),1==d.addDeterExtraMarkups){var u
this.each(function(){u=" "+d.addClass+" deter-mode-"+s,("box-identicon"==s||"box-color"==s)&&(u+=" deter-behaviour-box"),e(this).addClass("deter-password").wrap('<div class="deter-container'+u+'"></div>'),"body"!=s&&"border"!=s&&"background"!=s&&e('<span class="deter-fingerprint"></span>').insertAfter(e(this))})}var l=null===d.selectorDelegated?this:d.selectorDelegated
switch(s){case"custom":d.callback=t
break
case"border":d.callback=o
break
case"background":d.callback=i
break
case"box-color":d.callback=c
break
default:d.callback=b}return e(l).on(d.events,d.selectorDescendant,d,n),this},e.fn.identicon=function(t,a,s){if(settings=e.extend({size:65},s),"auto"==settings.size){var n=e(this)
settings.size=Math.min(n.width(),n.height())}return this.each(r?function(){var r=e(this)
"string"==typeof t?r.text(t).identicon5(settings):r.text("")}:function(){var r=e(this)
if("string"==typeof t){var s=r.html('<span class="deter-fake-canevas"></span>')
s.css("width",settings.size).css("height",settings.size).css("background-color",a)}else r.text("")}),this},e(document).ready(function(){e("body").on("click","div.deter-container.deter-behaviour-box",function(){var t=e(this).children(".deter-password")
t.focus()}).on("focus","div.deter-container.deter-behaviour-box > .deter-password",function(){if(""!=e(this).val()){var t=e(this).parent("div.deter-container.deter-behaviour-box")
t.addClass("focused")}}).on("blur","div.deter-container.deter-behaviour-box > .deter-password",function(){var t=e(this).parent("div.deter-container.deter-behaviour-box")
t.removeClass("focused")}).on("keyup","div.deter-container.deter-behaviour-box > .deter-password",function(){var t=e(this).parent("div.deter-container.deter-behaviour-box"),r=e(this).siblings("span.deter-fingerprint")
""!=e(this).val()?(t.addClass("focused"),r.addClass("visible").attr("title",e.deter.boxTitle)):(t.removeClass("focused"),r.removeClass("visible").removeAttr("title"))}).on("repaint","div.deter-container.deter-mode-box-identicon > .deter-password",function(t,r){e(this).siblings(".deter-fingerprint").trigger("repaint",r)}).on("repaint",".deter-fingerprint",function(t,r){var a=e(this)
r="object"==typeof r?r:{}
var s=void 0===r.value?a.siblings(".deter-password").val():r.value,n=void 0===r.opacity?1:r.opacity,o=void 0===r.sequence?!1:r.sequence,i=void 0===r.canevasSize?"auto":r.canevasSize,c=e.strToColor(s,n,o)
a.identicon(c.md5,c.hex,{rotate:!0,size:i})}),setTimeout(function(){e(".div.deter-container.deter-behaviour-box > .deter-password").trigger("blur")},100)})}(jQuery)