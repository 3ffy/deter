/* deter - version: 3.7 - author: 3ffy (Aur√©lien Gy) - aureliengy@gmail.com - http://www.aureliengy.com - licence: BSD 3-Clause Licence (@see licence file or https://raw.githubusercontent.com/3ffy/deter/master/LICENSE). Note that the plugins "JQuery.Identicon5" by Francis Shanahan (http://archive.plugins.jquery.com/project/identicon5) and "JQuery.MD5" by Gabriele Romanato (http://blog.gabrieleromanato.com) are separated project and get their own licence. */
!function(e){e.md5=function(e){function t(e,t){return e<<t|e>>>32-t}function r(e,t){var r,a,n,o,s
return n=2147483648&e,o=2147483648&t,r=1073741824&e,a=1073741824&t,s=(1073741823&e)+(1073741823&t),r&a?2147483648^s^n^o:r|a?1073741824&s?3221225472^s^n^o:1073741824^s^n^o:s^n^o}function a(e,t,r){return e&t|~e&r}function n(e,t,r){return e&r|t&~r}function o(e,t,r){return e^t^r}function s(e,t,r){return t^(e|~r)}function i(e,n,o,s,i,c,b){return e=r(e,r(r(a(n,o,s),i),b)),r(t(e,c),n)}function c(e,a,o,s,i,c,b){return e=r(e,r(r(n(a,o,s),i),b)),r(t(e,c),a)}function b(e,a,n,s,i,c,b){return e=r(e,r(r(o(a,n,s),i),b)),r(t(e,c),a)}function l(e,a,n,o,i,c,b){return e=r(e,r(r(s(a,n,o),i),b)),r(t(e,c),a)}function d(e){for(var t,r=e.length,a=r+8,n=(a-a%64)/64,o=16*(n+1),s=Array(o-1),i=0,c=0;r>c;)t=(c-c%4)/4,i=c%4*8,s[t]=s[t]|e.charCodeAt(c)<<i,c++
return t=(c-c%4)/4,i=c%4*8,s[t]=s[t]|128<<i,s[o-2]=r<<3,s[o-1]=r>>>29,s}function u(e){var t,r,a="",n=""
for(r=0;3>=r;r++)t=e>>>8*r&255,n="0"+t.toString(16),a+=n.substr(n.length-2,2)
return a}function f(e){e=e.replace(/\r\n/g,"\n")
for(var t="",r=0;r<e.length;r++){var a=e.charCodeAt(r)
128>a?t+=String.fromCharCode(a):a>127&&2048>a?(t+=String.fromCharCode(a>>6|192),t+=String.fromCharCode(63&a|128)):(t+=String.fromCharCode(a>>12|224),t+=String.fromCharCode(a>>6&63|128),t+=String.fromCharCode(63&a|128))}return t}var g,h,v,p,x,w,m,k,y,C=[],z=7,M=12,T=17,I=22,R=5,S=9,$=14,L=20,j=4,D=11,X=16,A=23,q=6,F=10,E=15,P=21
for(e=f(e),C=d(e),w=1732584193,m=4023233417,k=2562383102,y=271733878,g=0;g<C.length;g+=16)h=w,v=m,p=k,x=y,w=i(w,m,k,y,C[g+0],z,3614090360),y=i(y,w,m,k,C[g+1],M,3905402710),k=i(k,y,w,m,C[g+2],T,606105819),m=i(m,k,y,w,C[g+3],I,3250441966),w=i(w,m,k,y,C[g+4],z,4118548399),y=i(y,w,m,k,C[g+5],M,1200080426),k=i(k,y,w,m,C[g+6],T,2821735955),m=i(m,k,y,w,C[g+7],I,4249261313),w=i(w,m,k,y,C[g+8],z,1770035416),y=i(y,w,m,k,C[g+9],M,2336552879),k=i(k,y,w,m,C[g+10],T,4294925233),m=i(m,k,y,w,C[g+11],I,2304563134),w=i(w,m,k,y,C[g+12],z,1804603682),y=i(y,w,m,k,C[g+13],M,4254626195),k=i(k,y,w,m,C[g+14],T,2792965006),m=i(m,k,y,w,C[g+15],I,1236535329),w=c(w,m,k,y,C[g+1],R,4129170786),y=c(y,w,m,k,C[g+6],S,3225465664),k=c(k,y,w,m,C[g+11],$,643717713),m=c(m,k,y,w,C[g+0],L,3921069994),w=c(w,m,k,y,C[g+5],R,3593408605),y=c(y,w,m,k,C[g+10],S,38016083),k=c(k,y,w,m,C[g+15],$,3634488961),m=c(m,k,y,w,C[g+4],L,3889429448),w=c(w,m,k,y,C[g+9],R,568446438),y=c(y,w,m,k,C[g+14],S,3275163606),k=c(k,y,w,m,C[g+3],$,4107603335),m=c(m,k,y,w,C[g+8],L,1163531501),w=c(w,m,k,y,C[g+13],R,2850285829),y=c(y,w,m,k,C[g+2],S,4243563512),k=c(k,y,w,m,C[g+7],$,1735328473),m=c(m,k,y,w,C[g+12],L,2368359562),w=b(w,m,k,y,C[g+5],j,4294588738),y=b(y,w,m,k,C[g+8],D,2272392833),k=b(k,y,w,m,C[g+11],X,1839030562),m=b(m,k,y,w,C[g+14],A,4259657740),w=b(w,m,k,y,C[g+1],j,2763975236),y=b(y,w,m,k,C[g+4],D,1272893353),k=b(k,y,w,m,C[g+7],X,4139469664),m=b(m,k,y,w,C[g+10],A,3200236656),w=b(w,m,k,y,C[g+13],j,681279174),y=b(y,w,m,k,C[g+0],D,3936430074),k=b(k,y,w,m,C[g+3],X,3572445317),m=b(m,k,y,w,C[g+6],A,76029189),w=b(w,m,k,y,C[g+9],j,3654602809),y=b(y,w,m,k,C[g+12],D,3873151461),k=b(k,y,w,m,C[g+15],X,530742520),m=b(m,k,y,w,C[g+2],A,3299628645),w=l(w,m,k,y,C[g+0],q,4096336452),y=l(y,w,m,k,C[g+7],F,1126891415),k=l(k,y,w,m,C[g+14],E,2878612391),m=l(m,k,y,w,C[g+5],P,4237533241),w=l(w,m,k,y,C[g+12],q,1700485571),y=l(y,w,m,k,C[g+3],F,2399980690),k=l(k,y,w,m,C[g+10],E,4293915773),m=l(m,k,y,w,C[g+1],P,2240044497),w=l(w,m,k,y,C[g+8],q,1873313359),y=l(y,w,m,k,C[g+15],F,4264355552),k=l(k,y,w,m,C[g+6],E,2734768916),m=l(m,k,y,w,C[g+13],P,1309151649),w=l(w,m,k,y,C[g+4],q,4149444226),y=l(y,w,m,k,C[g+11],F,3174756917),k=l(k,y,w,m,C[g+2],E,718787259),m=l(m,k,y,w,C[g+9],P,3951481745),w=r(w,h),m=r(m,v),k=r(k,p),y=r(y,x)
var Q=u(w)+u(m)+u(k)+u(y)
return Q.toLowerCase()},e.fn.identicon5=function(t){settings=jQuery.extend({rotate:!0,size:32},t)
var r=function(e,t){if(t.length>=2){e.beginPath(),e.moveTo(t[0],t[1])
for(var r=2;r<t.length;r++)e.lineTo(t[r],t[r+1]),r++
e.fill()}},a=function(e,t){switch(e){case 0:e=[.5,1,1,0,1,1]
break
case 1:e=[.5,0,1,0,.5,1,0,1]
break
case 2:e=[.5,0,1,0,1,1,.5,1,1,.5]
break
case 3:e=[0,.5,.5,0,1,.5,.5,1,.5,.5]
break
case 4:e=[0,.5,1,0,1,1,0,1,1,.5]
break
case 5:e=[1,0,1,1,.5,1,1,.5,.5,.5]
break
case 6:e=[0,0,1,0,1,.5,0,0,.5,1,0,1]
break
case 7:e=[0,0,.5,0,1,.5,.5,1,0,1,.5,.5]
break
case 8:e=[.5,0,.5,.5,1,.5,1,1,.5,1,.5,.5,0,.5]
break
case 9:e=[0,0,1,0,.5,.5,1,.5,.5,1,.5,.5,0,1]
break
case 10:e=[0,.5,.5,1,1,.5,.5,0,1,0,1,1,0,1]
break
case 11:e=[.5,0,1,0,1,1,.5,1,1,.75,.5,.5,1,.25]
break
case 12:e=[0,.5,.5,0,.5,.5,1,0,1,.5,.5,1,.5,.5,0,1]
break
case 13:e=[0,0,1,0,1,1,0,1,1,.5,.5,.25,.5,.75,0,.5,.5,.25]
break
case 14:e=[0,.5,.5,.5,.5,0,1,0,.5,.5,1,.5,.5,1,.5,.5,0,1]
break
default:e=[0,0,1,0,.5,.5,.5,0,0,.5,1,.5,.5,1,.5,.5,0,1]}for(var r=0;r<e.length;r++)e[r]=e[r]*t
return e},n=function(e,t){var n,o=t/5,s=o/2,i=0,c=0
e.strokeRect(0,0,o,o)
for(var b=0;15>b;b++){n=a(b,o),e.save(),e.translate(s+i*o,s+c*o)
for(var l=0;l<n.length;l++)n[l]-=s
r(e,n),e.strokeRect(-s,-s,o,o),e.restore(),i>=4?(i=0,c++):i++}},o=function(e,t,a,n,o,s,i){var c=i/2
e.save(),e.translate(a,n),e.rotate(s*Math.PI/180),e.save(),e.translate(c,c)
for(var b=[],l=0;l<t.length;l++)b[l]=t[l]-c
e.rotate(o),r(e,b),e.restore(),e.restore()},s=function(e,t){switch(e){case 0:e=[]
break
case 1:e=[0,0,1,0,1,1,0,1]
break
case 2:e=[.5,0,1,.5,.5,1,0,.5]
break
case 3:e=[0,0,1,0,1,1,0,1,0,.5,.5,1,1,.5,.5,0,0,.5]
break
case 4:e=[.25,0,.75,0,.5,.5,1,.25,1,.75,.5,.5,.75,1,.25,1,.5,.5,0,.75,0,.25,.5,.5]
break
case 5:e=[0,0,.5,.25,1,0,.75,.5,1,1,.5,.75,0,1,.25,.5]
break
case 6:e=[.33,.33,.67,.33,.67,.67,.33,.67]
break
case 7:e=[0,0,.33,0,.33,.33,.66,.33,.67,0,1,0,1,.33,.67,.33,.67,.67,1,.67,1,1,.67,1,.67,.67,.33,.67,.33,1,0,1,0,.67,.33,.67,.33,.33,0,.33]
break
default:e=[0,0,1,0,.5,.5,.5,0,0,.5,1,.5,.5,1,.5,.5,0,1]}for(var r=0;r<e.length;r++)e[r]=e[r]*t
return e},i=function(e,t,r,n){var i=parseInt(t.substr(0,1),16),c=parseInt(t.substr(1,1),16),b=7&parseInt(t.substr(2,1),16),l=Math.PI/2,d=l*(3&parseInt(t.substr(3,1),16)),u=l*(3&parseInt(t.substr(4,1),16)),f=parseInt(t.substr(5,1),16)%2,g=parseInt(t.substr(6,2),16),h=parseInt(t.substr(8,2),16),v=parseInt(t.substr(10,2),16),p=parseInt(t.substr(12,2),16),x=parseInt(t.substr(14,2),16),w=parseInt(t.substr(16,2),16),m=r/3,k=r,y=a(i,m)
e.fillStyle="rgb("+g+","+h+","+v+")",n===!1&&(d=0),o(e,y,0,0,d,0,m),o(e,y,k,0,d,90,m),o(e,y,k,k,d,180,m),o(e,y,0,k,d,270,m),n===!1&&(u=0)
var C=a(c,m)
e.fillStyle="rgb("+p+","+x+","+w+")",o(e,C,0,m,u,0,m),o(e,C,2*m,0,u,90,m),o(e,C,3*m,2*m,u,180,m),o(e,C,m,3*m,u,270,m)
var z=s(b,m)
e.fillStyle=f>0&&(Math.abs(g-p)>127||Math.abs(h-x)>127||Math.abs(v-w)>127)?"rgb("+p+","+x+","+w+")":"rgb("+g+","+h+","+v+")",o(e,z,m,m,0,0,m)}
return this.each(function(){var t=e(this).html(),r=document.createElement("canvas")
if(r.getContext){r.width=settings.size,r.height=settings.size
var a=r.getContext("2d")
"test"===t?n(a,settings.size):i(a,t,settings.size,settings.rotate),e(this).html(""),e(this).append(r)}})}
var t=document.createElement("canvas"),r=t.getContext?!0:!1,a={}
a.boxTitle="If this picture is not the one you use to see, your password is misspelled.",a.autofillDrawIdenticon=!0,a.wrapWithMarkup=function(t,r,a){if("string"!=typeof r)throw"Param 'mode' is mandatory."
"default"==r&&(r="box-identicon"),"string"!=typeof a&&(a=""),$elem=e(t),classbox=" "+a+" deter-mode-"+r,("box-identicon"==r||"box-color"==r)&&(classbox+=" deter-behaviour-box"),$elem.addClass("deter-password").wrap('<div class="deter-container'+classbox+'"></div>'),"body"!=r&&"border"!=r&&"background"!=r&&e('<span class="deter-fingerprint"></span>').insertAfter($elem)}
var n=function(t,r){var a={}
a.md5=e.md5(t),a.hexRaw=a.md5.substr(0,6),a.hex="#"+a.hexRaw,a.rgbRaw=e.hexToRgb(a.hexRaw,!0),a.rgb="rgb("+a.rgbRaw.r+", "+a.rgbRaw.g+", "+a.rgbRaw.b+")"
var n="number"==typeof r?r:1
return a.rgbaRaw=a.rgbRaw,a.rgbaRaw.a=n,a.rgba="rgba("+a.rgbaRaw.r+", "+a.rgbaRaw.g+", "+a.rgbaRaw.b+", "+a.rgbaRaw.a+")",a},o=function(t){var r=t.data,a="function"==typeof r.getContent?r.getContent.call(this):e(this).val(),n=e.strToColor(a,r.opacity,r.sequence)
r.callback.call(this,r,n,a)},s=function(t,r,a){if($elem=e("string"==typeof t.target?t.target:this),""==a)$elem.css("-webkit-box-shadow","").css("-moz-box-shadow","").css("box-shadow","").css("border-color","")
else{var n="inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px "+r.rgba
$elem.css("-webkit-box-shadow",n).css("-moz-box-shadow",n).css("box-shadow",n).css("border-color",r.hex)}},i=function(t,r,a){if($elem=e("string"==typeof t.target?t.target:this),$elem.css("background-color",""==a?"":r.hex),"complementary"==t.textColorMode){var n=e.getComplementaryColor(r.rgbRaw)
$elem.css("color","rgb("+n.r+","+n.g+","+n.b+")")}else if("monochrome"==t.textColorMode){var o=e.getFurtherColor(r.rgbRaw)
$elem.css("color","rgb("+o.r+","+o.g+","+o.b+")")}},c=function(t,r,a){var n=e(this).siblings("span.deter-fingerprint")
n.css("background-color",""==a?"":r.hex)},b=function(t,r,a){var n=e(this).siblings("span.deter-fingerprint")
""==a?n.text(""):n.identicon(r.md5,r.hex,{rotate:!0,size:t.canevasSize})}
e.extend({deter:a,hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i
e=e.replace(t,function(e,t,r,a){return t+t+r+r+a+a})
var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e)
return r?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:null},rgbToXyz:function(e){var t={},r=parseFloat(e.r/255),a=parseFloat(e.g/255),n=parseFloat(e.b/255)
return r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,a=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=100*r,a=100*a,n=100*n,t.x=.4124*r+.3576*a+.1805*n,t.y=.2126*r+.7152*a+.0722*n,t.z=.0193*r+.1192*a+.9505*n,t},xyzToLab:function(e){var t={},r=e.x/95.047,a=e.y/100,n=e.z/108.883
return r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,n=n>.008856?Math.pow(n,1/3):7.787*n+16/116,t.l=116*a-16,t.a=500*(r-a),t.b=200*(a-n),t},getComplementaryColor:function(e,t){var r={}
return r.r=Math.abs(255-e.r),r.g=Math.abs(1==t?255-(e.r+e.b)/2:255-e.g),r.b=Math.abs(255-e.b),r},getClosestColor:function(t,r,n){"object"!=typeof r&&(rbgcandidate1={r:0,g:0,b:0}),"object"!=typeof n&&(n={r:255,g:255,b:255})
var o=e.rgbToXyz(a.rgbRaw),s=e.xyzToLab(o),i=e.rgbToXyz(r),c=e.xyzToLab(i),b=e.rgbToXyz(n),l=e.xyzToLab(b),d=Math.abs(c.l-s.l)+Math.abs(c.a-s.a)+Math.abs(c.b-s.b),u=Math.abs(l.l-s.l)+Math.abs(l.a-s.a)+Math.abs(l.b-s.b)
return u>=d?r:n},getFurtherColor:function(t,r,a){"object"!=typeof r&&(r={r:0,g:0,b:0}),"object"!=typeof a&&(a={r:255,g:255,b:255})
var n=e.rgbToXyz(t),o=e.xyzToLab(n),s=e.rgbToXyz(r),i=e.xyzToLab(s),c=e.rgbToXyz(a),b=e.xyzToLab(c),l=Math.abs(i.l-o.l)+Math.abs(i.a-o.a)+Math.abs(i.b-o.b),d=Math.abs(b.l-o.l)+Math.abs(b.a-o.a)+Math.abs(b.b-o.b)
return l>d?r:a},strToColor:function(e,t,r){var a
if(r!==!0)a=n(e,t)
else{a=[]
var o,s,i=e.length
for(o=0;i>o;o++)s=e.substr(0,o+1),a.push(n(s,t))}return a}}),e.fn.deter=function(t,a){var n,l=e.extend({sequence:!1,opacity:1,canevasSize:"auto",addDeterExtraMarkups:!0,getContent:null,events:"keyup",selectorDelegated:null,addClass:"",textColorMode:"default",target:null},a)
switch("function"==typeof t?(n="custom",l.sequence=!1):n="string"==typeof t&&"default"!=t?t:"box-identicon","box-identicon"==n&&0==r&&(n="box-color"),null===l.selectorDelegated&&1==l.addDeterExtraMarkups&&e.deter.wrapWithMarkup(this,n,l.addClass),n){case"custom":l.callback=t
break
case"border":l.callback=s
break
case"background":l.callback=i
break
case"box-color":l.callback=c
break
default:l.callback=b}return e(this).on(l.events,l.selectorDelegated,l,o),this},e.fn.identicon=function(t,a,n){if(settings=e.extend({size:65},n),"auto"==settings.size){var o=e(this),s=o.width(),i=o.height()
settings.size=0==s?i:0==i?s:Math.min(s,i)}return this.each(r?function(){var r=e(this)
"string"==typeof t?r.text(t).identicon5(settings):r.text("")}:function(){var r=e(this)
if("string"==typeof t){var n=r.html('<span class="deter-fake-canevas"></span>')
n.css("width",settings.size).css("height",settings.size).css("background-color",a)}else r.text("")}),this},e(document).ready(function(){e("body").on("click","div.deter-container.deter-behaviour-box",function(){var t=e(this).children(".deter-password")
t.focus()}).on("focus","div.deter-container.deter-behaviour-box > .deter-password",function(){if(""!=e(this).val()){var t=e(this).parent("div.deter-container.deter-behaviour-box")
t.addClass("focused")}}).on("blur","div.deter-container.deter-behaviour-box > .deter-password",function(){var t=e(this).parent("div.deter-container.deter-behaviour-box")
t.removeClass("focused")}).on("keyup","div.deter-container.deter-behaviour-box > .deter-password",function(){var t=e(this).parent("div.deter-container.deter-behaviour-box"),r=e(this).siblings("span.deter-fingerprint")
""!=e(this).val()?(t.addClass("focused"),r.addClass("visible").attr("title",e.deter.boxTitle)):(t.removeClass("focused"),r.removeClass("visible").removeAttr("title"))}).on("repaint","div.deter-container.deter-mode-box-identicon > .deter-password",function(t,r){e(this).siblings(".deter-fingerprint").trigger("repaint",r)}).on("repaint",".deter-fingerprint",function(t,r){var a=e(this)
r="object"==typeof r?r:{}
var n=void 0===r.value?a.siblings(".deter-password").val():r.value,o=void 0===r.opacity?1:r.opacity,s=void 0===r.sequence?!1:r.sequence,i=void 0===r.canevasSize?"auto":r.canevasSize,c=e.strToColor(n,o,s)
a.identicon(c.md5,c.hex,{rotate:!0,size:i})})}),1==e.deter.autofillDrawIdenticon&&e(window).load(function(){var t=/webkit/.test(navigator.userAgent.toLowerCase())
e("div.deter-container.deter-mode-box-identicon > .deter-password").each(function(){var r=e(this)
if(1==t&&r.filter(":-webkit-autofill"))var a=setInterval(function(){1==r.is(":visible")&&setTimeout(function(){""!=r.val()&&r.trigger("repaint"),window.clearInterval(a)},100)},300)
else setTimeout(function(){""!=r.val()&&r.trigger("repaint")},100)})})}(jQuery)