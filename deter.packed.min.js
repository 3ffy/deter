/* deter - version: 3.4 - author: 3ffy (Aur√©lien Gy) - aureliengy@gmail.com - http://www.aureliengy.com - licence: BSD 3-Clause Licence (@see licence file or https://raw.githubusercontent.com/3ffy/deter/master/LICENSE). Note that the plugins "JQuery.Identicon5" by Francis Shanahan (http://archive.plugins.jquery.com/project/identicon5) and "JQuery.MD5" by Gabriele Romanato (http://blog.gabrieleromanato.com) are separated project and get their own licence. */
!function(e){e.md5=function(e){function t(e,t){return e<<t|e>>>32-t}function r(e,t){var r,a,o,s,n
return o=2147483648&e,s=2147483648&t,r=1073741824&e,a=1073741824&t,n=(1073741823&e)+(1073741823&t),r&a?2147483648^n^o^s:r|a?1073741824&n?3221225472^n^o^s:1073741824^n^o^s:n^o^s}function a(e,t,r){return e&t|~e&r}function o(e,t,r){return e&r|t&~r}function s(e,t,r){return e^t^r}function n(e,t,r){return t^(e|~r)}function i(e,o,s,n,i,c,b){return e=r(e,r(r(a(o,s,n),i),b)),r(t(e,c),o)}function c(e,a,s,n,i,c,b){return e=r(e,r(r(o(a,s,n),i),b)),r(t(e,c),a)}function b(e,a,o,n,i,c,b){return e=r(e,r(r(s(a,o,n),i),b)),r(t(e,c),a)}function d(e,a,o,s,i,c,b){return e=r(e,r(r(n(a,o,s),i),b)),r(t(e,c),a)}function l(e){for(var t,r=e.length,a=r+8,o=(a-a%64)/64,s=16*(o+1),n=Array(s-1),i=0,c=0;r>c;)t=(c-c%4)/4,i=c%4*8,n[t]=n[t]|e.charCodeAt(c)<<i,c++
return t=(c-c%4)/4,i=c%4*8,n[t]=n[t]|128<<i,n[s-2]=r<<3,n[s-1]=r>>>29,n}function u(e){var t,r,a="",o=""
for(r=0;3>=r;r++)t=e>>>8*r&255,o="0"+t.toString(16),a+=o.substr(o.length-2,2)
return a}function h(e){e=e.replace(/\r\n/g,"\n")
for(var t="",r=0;r<e.length;r++){var a=e.charCodeAt(r)
128>a?t+=String.fromCharCode(a):a>127&&2048>a?(t+=String.fromCharCode(a>>6|192),t+=String.fromCharCode(63&a|128)):(t+=String.fromCharCode(a>>12|224),t+=String.fromCharCode(a>>6&63|128),t+=String.fromCharCode(63&a|128))}return t}var f,g,v,p,x,m,y,w,k,C=[],z=7,M=12,T=17,R=22,I=5,S=9,$=14,L=20,j=4,X=11,q=16,A=23,D=6,F=10,E=15,P=21
for(e=h(e),C=l(e),m=1732584193,y=4023233417,w=2562383102,k=271733878,f=0;f<C.length;f+=16)g=m,v=y,p=w,x=k,m=i(m,y,w,k,C[f+0],z,3614090360),k=i(k,m,y,w,C[f+1],M,3905402710),w=i(w,k,m,y,C[f+2],T,606105819),y=i(y,w,k,m,C[f+3],R,3250441966),m=i(m,y,w,k,C[f+4],z,4118548399),k=i(k,m,y,w,C[f+5],M,1200080426),w=i(w,k,m,y,C[f+6],T,2821735955),y=i(y,w,k,m,C[f+7],R,4249261313),m=i(m,y,w,k,C[f+8],z,1770035416),k=i(k,m,y,w,C[f+9],M,2336552879),w=i(w,k,m,y,C[f+10],T,4294925233),y=i(y,w,k,m,C[f+11],R,2304563134),m=i(m,y,w,k,C[f+12],z,1804603682),k=i(k,m,y,w,C[f+13],M,4254626195),w=i(w,k,m,y,C[f+14],T,2792965006),y=i(y,w,k,m,C[f+15],R,1236535329),m=c(m,y,w,k,C[f+1],I,4129170786),k=c(k,m,y,w,C[f+6],S,3225465664),w=c(w,k,m,y,C[f+11],$,643717713),y=c(y,w,k,m,C[f+0],L,3921069994),m=c(m,y,w,k,C[f+5],I,3593408605),k=c(k,m,y,w,C[f+10],S,38016083),w=c(w,k,m,y,C[f+15],$,3634488961),y=c(y,w,k,m,C[f+4],L,3889429448),m=c(m,y,w,k,C[f+9],I,568446438),k=c(k,m,y,w,C[f+14],S,3275163606),w=c(w,k,m,y,C[f+3],$,4107603335),y=c(y,w,k,m,C[f+8],L,1163531501),m=c(m,y,w,k,C[f+13],I,2850285829),k=c(k,m,y,w,C[f+2],S,4243563512),w=c(w,k,m,y,C[f+7],$,1735328473),y=c(y,w,k,m,C[f+12],L,2368359562),m=b(m,y,w,k,C[f+5],j,4294588738),k=b(k,m,y,w,C[f+8],X,2272392833),w=b(w,k,m,y,C[f+11],q,1839030562),y=b(y,w,k,m,C[f+14],A,4259657740),m=b(m,y,w,k,C[f+1],j,2763975236),k=b(k,m,y,w,C[f+4],X,1272893353),w=b(w,k,m,y,C[f+7],q,4139469664),y=b(y,w,k,m,C[f+10],A,3200236656),m=b(m,y,w,k,C[f+13],j,681279174),k=b(k,m,y,w,C[f+0],X,3936430074),w=b(w,k,m,y,C[f+3],q,3572445317),y=b(y,w,k,m,C[f+6],A,76029189),m=b(m,y,w,k,C[f+9],j,3654602809),k=b(k,m,y,w,C[f+12],X,3873151461),w=b(w,k,m,y,C[f+15],q,530742520),y=b(y,w,k,m,C[f+2],A,3299628645),m=d(m,y,w,k,C[f+0],D,4096336452),k=d(k,m,y,w,C[f+7],F,1126891415),w=d(w,k,m,y,C[f+14],E,2878612391),y=d(y,w,k,m,C[f+5],P,4237533241),m=d(m,y,w,k,C[f+12],D,1700485571),k=d(k,m,y,w,C[f+3],F,2399980690),w=d(w,k,m,y,C[f+10],E,4293915773),y=d(y,w,k,m,C[f+1],P,2240044497),m=d(m,y,w,k,C[f+8],D,1873313359),k=d(k,m,y,w,C[f+15],F,4264355552),w=d(w,k,m,y,C[f+6],E,2734768916),y=d(y,w,k,m,C[f+13],P,1309151649),m=d(m,y,w,k,C[f+4],D,4149444226),k=d(k,m,y,w,C[f+11],F,3174756917),w=d(w,k,m,y,C[f+2],E,718787259),y=d(y,w,k,m,C[f+9],P,3951481745),m=r(m,g),y=r(y,v),w=r(w,p),k=r(k,x)
var Q=u(m)+u(y)+u(w)+u(k)
return Q.toLowerCase()},e.fn.identicon5=function(t){settings=jQuery.extend({rotate:!0,size:32},t)
var r=function(e,t){if(t.length>=2){e.beginPath(),e.moveTo(t[0],t[1])
for(var r=2;r<t.length;r++)e.lineTo(t[r],t[r+1]),r++
e.fill()}},a=function(e,t){switch(e){case 0:e=[.5,1,1,0,1,1]
break
case 1:e=[.5,0,1,0,.5,1,0,1]
break
case 2:e=[.5,0,1,0,1,1,.5,1,1,.5]
break
case 3:e=[0,.5,.5,0,1,.5,.5,1,.5,.5]
break
case 4:e=[0,.5,1,0,1,1,0,1,1,.5]
break
case 5:e=[1,0,1,1,.5,1,1,.5,.5,.5]
break
case 6:e=[0,0,1,0,1,.5,0,0,.5,1,0,1]
break
case 7:e=[0,0,.5,0,1,.5,.5,1,0,1,.5,.5]
break
case 8:e=[.5,0,.5,.5,1,.5,1,1,.5,1,.5,.5,0,.5]
break
case 9:e=[0,0,1,0,.5,.5,1,.5,.5,1,.5,.5,0,1]
break
case 10:e=[0,.5,.5,1,1,.5,.5,0,1,0,1,1,0,1]
break
case 11:e=[.5,0,1,0,1,1,.5,1,1,.75,.5,.5,1,.25]
break
case 12:e=[0,.5,.5,0,.5,.5,1,0,1,.5,.5,1,.5,.5,0,1]
break
case 13:e=[0,0,1,0,1,1,0,1,1,.5,.5,.25,.5,.75,0,.5,.5,.25]
break
case 14:e=[0,.5,.5,.5,.5,0,1,0,.5,.5,1,.5,.5,1,.5,.5,0,1]
break
default:e=[0,0,1,0,.5,.5,.5,0,0,.5,1,.5,.5,1,.5,.5,0,1]}for(var r=0;r<e.length;r++)e[r]=e[r]*t
return e},o=function(e,t){var o,s=t/5,n=s/2,i=0,c=0
e.strokeRect(0,0,s,s)
for(var b=0;15>b;b++){o=a(b,s),e.save(),e.translate(n+i*s,n+c*s)
for(var d=0;d<o.length;d++)o[d]-=n
r(e,o),e.strokeRect(-n,-n,s,s),e.restore(),i>=4?(i=0,c++):i++}},s=function(e,t,a,o,s,n,i){var c=i/2
e.save(),e.translate(a,o),e.rotate(n*Math.PI/180),e.save(),e.translate(c,c)
for(var b=[],d=0;d<t.length;d++)b[d]=t[d]-c
e.rotate(s),r(e,b),e.restore(),e.restore()},n=function(e,t){switch(e){case 0:e=[]
break
case 1:e=[0,0,1,0,1,1,0,1]
break
case 2:e=[.5,0,1,.5,.5,1,0,.5]
break
case 3:e=[0,0,1,0,1,1,0,1,0,.5,.5,1,1,.5,.5,0,0,.5]
break
case 4:e=[.25,0,.75,0,.5,.5,1,.25,1,.75,.5,.5,.75,1,.25,1,.5,.5,0,.75,0,.25,.5,.5]
break
case 5:e=[0,0,.5,.25,1,0,.75,.5,1,1,.5,.75,0,1,.25,.5]
break
case 6:e=[.33,.33,.67,.33,.67,.67,.33,.67]
break
case 7:e=[0,0,.33,0,.33,.33,.66,.33,.67,0,1,0,1,.33,.67,.33,.67,.67,1,.67,1,1,.67,1,.67,.67,.33,.67,.33,1,0,1,0,.67,.33,.67,.33,.33,0,.33]
break
default:e=[0,0,1,0,.5,.5,.5,0,0,.5,1,.5,.5,1,.5,.5,0,1]}for(var r=0;r<e.length;r++)e[r]=e[r]*t
return e},i=function(e,t,r,o){var i=parseInt(t.substr(0,1),16),c=parseInt(t.substr(1,1),16),b=7&parseInt(t.substr(2,1),16),d=Math.PI/2,l=d*(3&parseInt(t.substr(3,1),16)),u=d*(3&parseInt(t.substr(4,1),16)),h=parseInt(t.substr(5,1),16)%2,f=parseInt(t.substr(6,2),16),g=parseInt(t.substr(8,2),16),v=parseInt(t.substr(10,2),16),p=parseInt(t.substr(12,2),16),x=parseInt(t.substr(14,2),16),m=parseInt(t.substr(16,2),16),y=r/3,w=r,k=a(i,y)
e.fillStyle="rgb("+f+","+g+","+v+")",o===!1&&(l=0),s(e,k,0,0,l,0,y),s(e,k,w,0,l,90,y),s(e,k,w,w,l,180,y),s(e,k,0,w,l,270,y),o===!1&&(u=0)
var C=a(c,y)
e.fillStyle="rgb("+p+","+x+","+m+")",s(e,C,0,y,u,0,y),s(e,C,2*y,0,u,90,y),s(e,C,3*y,2*y,u,180,y),s(e,C,y,3*y,u,270,y)
var z=n(b,y)
e.fillStyle=h>0&&(Math.abs(f-p)>127||Math.abs(g-x)>127||Math.abs(v-m)>127)?"rgb("+p+","+x+","+m+")":"rgb("+f+","+g+","+v+")",s(e,z,y,y,0,0,y)}
return this.each(function(){var t=e(this).html(),r=document.createElement("canvas")
if(r.getContext){r.width=settings.size,r.height=settings.size
var a=r.getContext("2d")
"test"===t?o(a,settings.size):i(a,t,settings.size,settings.rotate),e(this).html(""),e(this).append(r)}})}
var t=document.createElement("canvas"),r=t.getContext?!0:!1,a={}
a.boxTitle="If this picture is not the one you use to see, your password is misspelled.",a.wrapWithMarkup=function(t,r,a){if("string"!=typeof r)throw"Param 'mode' is mandatory."
"default"==r&&(r="box-identicon"),"string"!=typeof a&&(a=""),$elem=e(t),classbox=" "+a+" deter-mode-"+r,("box-identicon"==r||"box-color"==r)&&(classbox+=" deter-behaviour-box"),$elem.addClass("deter-password").wrap('<div class="deter-container'+classbox+'"></div>'),"body"!=r&&"border"!=r&&"background"!=r&&e('<span class="deter-fingerprint"></span>').insertAfter($elem)}
var o=function(t,r){var a={}
a.md5=e.md5(t),a.hexRaw=a.md5.substr(0,6),a.hex="#"+a.hexRaw,a.rgbRaw=e.hexToRgb(a.hexRaw,!0),a.rgb="rgb("+a.rgbRaw.r+", "+a.rgbRaw.g+", "+a.rgbRaw.b+")"
var o="number"==typeof r?r:1
return a.rgbaRaw=a.rgbRaw,a.rgbaRaw.a=o,a.rgba="rgba("+a.rgbaRaw.r+", "+a.rgbaRaw.g+", "+a.rgbaRaw.b+", "+a.rgbaRaw.a+")",a},s=function(t){var r=t.data,a="function"==typeof r.getContent?r.getContent.call(this):e(this).val(),o=e.strToColor(a,r.opacity,r.sequence)
r.callback.call(this,r,o,a)},n=function(t,r,a){if($elem=e("string"==typeof t.target?t.target:this),""==a)$elem.css("-webkit-box-shadow","").css("-moz-box-shadow","").css("box-shadow","").css("border-color","")
else{var o="inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px "+r.rgba
$elem.css("-webkit-box-shadow",o).css("-moz-box-shadow",o).css("box-shadow",o).css("border-color",r.hex)}},i=function(t,r,a){if($elem=e("string"==typeof t.target?t.target:this),$elem.css("background-color",""==a?"":r.hex),"complementary"==t.textColorMode){var o=e.getComplementaryColor(r.rgbRaw)
$elem.css("color","rgb("+o.r+","+o.g+","+o.b+")")}else if("monochrome"==t.textColorMode){var s=e.getFurtherColor(r.rgbRaw)
$elem.css("color","rgb("+s.r+","+s.g+","+s.b+")")}},c=function(t,r,a){var o=e(this).siblings("span.deter-fingerprint")
o.css("background-color",""==a?"":r.hex)},b=function(t,r,a){var o=e(this).siblings("span.deter-fingerprint")
""==a?o.text(""):o.identicon(r.md5,r.hex,{rotate:!0,size:t.canevasSize})}
e.extend({deter:a,hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i
e=e.replace(t,function(e,t,r,a){return t+t+r+r+a+a})
var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e)
return r?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:null},rgbToXyz:function(e){var t={},r=parseFloat(e.r/255),a=parseFloat(e.g/255),o=parseFloat(e.b/255)
return r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,a=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92,o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92,r=100*r,a=100*a,o=100*o,t.x=.4124*r+.3576*a+.1805*o,t.y=.2126*r+.7152*a+.0722*o,t.z=.0193*r+.1192*a+.9505*o,t},xyzToLab:function(e){var t={},r=e.x/95.047,a=e.y/100,o=e.z/108.883
return r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,t.l=116*a-16,t.a=500*(r-a),t.b=200*(a-o),t},getComplementaryColor:function(e,t){var r={}
return r.r=Math.abs(255-e.r),r.g=Math.abs(1==t?255-(e.r+e.b)/2:255-e.g),r.b=Math.abs(255-e.b),r},getClosestColor:function(t,r,o){"object"!=typeof r&&(rbgcandidate1={r:0,g:0,b:0}),"object"!=typeof o&&(o={r:255,g:255,b:255})
var s=e.rgbToXyz(a.rgbRaw),n=e.xyzToLab(s),i=e.rgbToXyz(r),c=e.xyzToLab(i),b=e.rgbToXyz(o),d=e.xyzToLab(b),l=Math.abs(c.l-n.l)+Math.abs(c.a-n.a)+Math.abs(c.b-n.b),u=Math.abs(d.l-n.l)+Math.abs(d.a-n.a)+Math.abs(d.b-n.b)
return u>=l?r:o},getFurtherColor:function(t,r,a){"object"!=typeof r&&(r={r:0,g:0,b:0}),"object"!=typeof a&&(a={r:255,g:255,b:255})
var o=e.rgbToXyz(t),s=e.xyzToLab(o),n=e.rgbToXyz(r),i=e.xyzToLab(n),c=e.rgbToXyz(a),b=e.xyzToLab(c),d=Math.abs(i.l-s.l)+Math.abs(i.a-s.a)+Math.abs(i.b-s.b),l=Math.abs(b.l-s.l)+Math.abs(b.a-s.a)+Math.abs(b.b-s.b)
return d>l?r:a},strToColor:function(e,t,r){var a
if(r!==!0)a=o(e,t)
else{a=[]
var s,n,i=e.length
for(s=0;i>s;s++)n=e.substr(0,s+1),a.push(o(n,t))}return a}}),e.fn.deter=function(t,a){var o,d=e.extend({sequence:!1,opacity:1,canevasSize:"auto",addDeterExtraMarkups:!0,getContent:null,events:"keyup",selectorDelegated:null,addClass:"",textColorMode:"default",target:null},a)
switch("function"==typeof t?(o="custom",d.sequence=!1):o="string"==typeof t&&"default"!=t?t:"box-identicon","box-identicon"==o&&0==r&&(o="box-color"),null===d.selectorDelegated&&1==d.addDeterExtraMarkups&&e.deter.wrapWithMarkup(this,o,d.addClass),o){case"custom":d.callback=t
break
case"border":d.callback=n
break
case"background":d.callback=i
break
case"box-color":d.callback=c
break
default:d.callback=b}return e(this).on(d.events,d.selectorDelegated,d,s),this},e.fn.identicon=function(t,a,o){if(settings=e.extend({size:65},o),"auto"==settings.size){var s=e(this),n=s.width(),i=s.height()
settings.size=0==n?i:0==i?n:Math.min(n,i)}return this.each(r?function(){var r=e(this)
"string"==typeof t?r.text(t).identicon5(settings):r.text("")}:function(){var r=e(this)
if("string"==typeof t){var o=r.html('<span class="deter-fake-canevas"></span>')
o.css("width",settings.size).css("height",settings.size).css("background-color",a)}else r.text("")}),this},e(document).ready(function(){e("body").on("click","div.deter-container.deter-behaviour-box",function(){var t=e(this).children(".deter-password")
t.focus()}).on("focus","div.deter-container.deter-behaviour-box > .deter-password",function(){if(""!=e(this).val()){var t=e(this).parent("div.deter-container.deter-behaviour-box")
t.addClass("focused")}}).on("blur","div.deter-container.deter-behaviour-box > .deter-password",function(){var t=e(this).parent("div.deter-container.deter-behaviour-box")
t.removeClass("focused")}).on("keyup","div.deter-container.deter-behaviour-box > .deter-password",function(){var t=e(this).parent("div.deter-container.deter-behaviour-box"),r=e(this).siblings("span.deter-fingerprint")
""!=e(this).val()?(t.addClass("focused"),r.addClass("visible").attr("title",e.deter.boxTitle)):(t.removeClass("focused"),r.removeClass("visible").removeAttr("title"))}).on("repaint","div.deter-container.deter-mode-box-identicon > .deter-password",function(t,r){e(this).siblings(".deter-fingerprint").trigger("repaint",r)}).on("repaint",".deter-fingerprint",function(t,r){var a=e(this)
r="object"==typeof r?r:{}
var o=void 0===r.value?a.siblings(".deter-password").val():r.value,s=void 0===r.opacity?1:r.opacity,n=void 0===r.sequence?!1:r.sequence,i=void 0===r.canevasSize?"auto":r.canevasSize,c=e.strToColor(o,s,n)
a.identicon(c.md5,c.hex,{rotate:!0,size:i})}),setTimeout(function(){e("div.deter-container.deter-behaviour-box > .deter-password").each(function(){var t=e(this)
""==t.val()&&t.trigger("repaint")})},100)})}(jQuery)