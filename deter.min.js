/* deter - version: 3.4 - author: 3ffy (Aur√©lien Gy) - aureliengy@gmail.com - http://www.aureliengy.com - licence: BSD 3-Clause Licence (@see licence file or https://raw.githubusercontent.com/3ffy/deter/master/LICENSE). Note that the plugins "JQuery.Identicon5" by Francis Shanahan (http://archive.plugins.jquery.com/project/identicon5) and "JQuery.MD5" by Gabriele Romanato (http://blog.gabrieleromanato.com) are separated project and get their own licence. */
!function(e){var t=document.createElement("canvas"),a=t.getContext?!0:!1,r={}
r.boxTitle="If this picture is not the one you use to see, your password is misspelled.",r.wrapWithMarkup=function(t,a,r){if("string"!=typeof a)throw"Param 'mode' is mandatory."
"default"==a&&(a="box-identicon"),"string"!=typeof r&&(r=""),$elem=e(t),classbox=" "+r+" deter-mode-"+a,("box-identicon"==a||"box-color"==a)&&(classbox+=" deter-behaviour-box"),$elem.addClass("deter-password").wrap('<div class="deter-container'+classbox+'"></div>'),"body"!=a&&"border"!=a&&"background"!=a&&e('<span class="deter-fingerprint"></span>').insertAfter($elem)}
var o=function(t,a){var r={}
r.md5=e.md5(t),r.hexRaw=r.md5.substr(0,6),r.hex="#"+r.hexRaw,r.rgbRaw=e.hexToRgb(r.hexRaw,!0),r.rgb="rgb("+r.rgbRaw.r+", "+r.rgbRaw.g+", "+r.rgbRaw.b+")"
var o="number"==typeof a?a:1
return r.rgbaRaw=r.rgbRaw,r.rgbaRaw.a=o,r.rgba="rgba("+r.rgbaRaw.r+", "+r.rgbaRaw.g+", "+r.rgbaRaw.b+", "+r.rgbaRaw.a+")",r},s=function(t){var a=t.data,r="function"==typeof a.getContent?a.getContent.call(this):e(this).val(),o=e.strToColor(r,a.opacity,a.sequence)
a.callback.call(this,a,o,r)},n=function(t,a,r){if($elem=e("string"==typeof t.target?t.target:this),""==r)$elem.css("-webkit-box-shadow","").css("-moz-box-shadow","").css("box-shadow","").css("border-color","")
else{var o="inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px "+a.rgba
$elem.css("-webkit-box-shadow",o).css("-moz-box-shadow",o).css("box-shadow",o).css("border-color",a.hex)}},i=function(t,a,r){if($elem=e("string"==typeof t.target?t.target:this),$elem.css("background-color",""==r?"":a.hex),"complementary"==t.textColorMode){var o=e.getComplementaryColor(a.rgbRaw)
$elem.css("color","rgb("+o.r+","+o.g+","+o.b+")")}else if("monochrome"==t.textColorMode){var s=e.getFurtherColor(a.rgbRaw)
$elem.css("color","rgb("+s.r+","+s.g+","+s.b+")")}},b=function(t,a,r){var o=e(this).siblings("span.deter-fingerprint")
o.css("background-color",""==r?"":a.hex)},c=function(t,a,r){var o=e(this).siblings("span.deter-fingerprint")
""==r?o.text(""):o.identicon(a.md5,a.hex,{rotate:!0,size:t.canevasSize})}
e.extend({deter:r,hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i
e=e.replace(t,function(e,t,a,r){return t+t+a+a+r+r})
var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e)
return a?{r:parseInt(a[1],16),g:parseInt(a[2],16),b:parseInt(a[3],16)}:null},rgbToXyz:function(e){var t={},a=parseFloat(e.r/255),r=parseFloat(e.g/255),o=parseFloat(e.b/255)
return a=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92,a=100*a,r=100*r,o=100*o,t.x=.4124*a+.3576*r+.1805*o,t.y=.2126*a+.7152*r+.0722*o,t.z=.0193*a+.1192*r+.9505*o,t},xyzToLab:function(e){var t={},a=e.x/95.047,r=e.y/100,o=e.z/108.883
return a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,t.l=116*r-16,t.a=500*(a-r),t.b=200*(r-o),t},getComplementaryColor:function(e,t){var a={}
return a.r=Math.abs(255-e.r),a.g=Math.abs(1==t?255-(e.r+e.b)/2:255-e.g),a.b=Math.abs(255-e.b),a},getClosestColor:function(t,a,o){"object"!=typeof a&&(rbgcandidate1={r:0,g:0,b:0}),"object"!=typeof o&&(o={r:255,g:255,b:255})
var s=e.rgbToXyz(r.rgbRaw),n=e.xyzToLab(s),i=e.rgbToXyz(a),b=e.xyzToLab(i),c=e.rgbToXyz(o),d=e.xyzToLab(c),l=Math.abs(b.l-n.l)+Math.abs(b.a-n.a)+Math.abs(b.b-n.b),u=Math.abs(d.l-n.l)+Math.abs(d.a-n.a)+Math.abs(d.b-n.b)
return u>=l?a:o},getFurtherColor:function(t,a,r){"object"!=typeof a&&(a={r:0,g:0,b:0}),"object"!=typeof r&&(r={r:255,g:255,b:255})
var o=e.rgbToXyz(t),s=e.xyzToLab(o),n=e.rgbToXyz(a),i=e.xyzToLab(n),b=e.rgbToXyz(r),c=e.xyzToLab(b),d=Math.abs(i.l-s.l)+Math.abs(i.a-s.a)+Math.abs(i.b-s.b),l=Math.abs(c.l-s.l)+Math.abs(c.a-s.a)+Math.abs(c.b-s.b)
return d>l?a:r},strToColor:function(e,t,a){var r
if(a!==!0)r=o(e,t)
else{r=[]
var s,n,i=e.length
for(s=0;i>s;s++)n=e.substr(0,s+1),r.push(o(n,t))}return r}}),e.fn.deter=function(t,r){var o,d=e.extend({sequence:!1,opacity:1,canevasSize:"auto",addDeterExtraMarkups:!0,getContent:null,events:"keyup",selectorDelegated:null,addClass:"",textColorMode:"default",target:null},r)
switch("function"==typeof t?(o="custom",d.sequence=!1):o="string"==typeof t&&"default"!=t?t:"box-identicon","box-identicon"==o&&0==a&&(o="box-color"),null===d.selectorDelegated&&1==d.addDeterExtraMarkups&&e.deter.wrapWithMarkup(this,o,d.addClass),o){case"custom":d.callback=t
break
case"border":d.callback=n
break
case"background":d.callback=i
break
case"box-color":d.callback=b
break
default:d.callback=c}return e(this).on(d.events,d.selectorDelegated,d,s),this},e.fn.identicon=function(t,r,o){if(settings=e.extend({size:65},o),"auto"==settings.size){var s=e(this),n=s.width(),i=s.height()
settings.size=0==n?i:0==i?n:Math.min(n,i)}return this.each(a?function(){var a=e(this)
"string"==typeof t?a.text(t).identicon5(settings):a.text("")}:function(){var a=e(this)
if("string"==typeof t){var o=a.html('<span class="deter-fake-canevas"></span>')
o.css("width",settings.size).css("height",settings.size).css("background-color",r)}else a.text("")}),this},e(document).ready(function(){e("body").on("click","div.deter-container.deter-behaviour-box",function(){var t=e(this).children(".deter-password")
t.focus()}).on("focus","div.deter-container.deter-behaviour-box > .deter-password",function(){if(""!=e(this).val()){var t=e(this).parent("div.deter-container.deter-behaviour-box")
t.addClass("focused")}}).on("blur","div.deter-container.deter-behaviour-box > .deter-password",function(){var t=e(this).parent("div.deter-container.deter-behaviour-box")
t.removeClass("focused")}).on("keyup","div.deter-container.deter-behaviour-box > .deter-password",function(){var t=e(this).parent("div.deter-container.deter-behaviour-box"),a=e(this).siblings("span.deter-fingerprint")
""!=e(this).val()?(t.addClass("focused"),a.addClass("visible").attr("title",e.deter.boxTitle)):(t.removeClass("focused"),a.removeClass("visible").removeAttr("title"))}).on("repaint","div.deter-container.deter-mode-box-identicon > .deter-password",function(t,a){e(this).siblings(".deter-fingerprint").trigger("repaint",a)}).on("repaint",".deter-fingerprint",function(t,a){var r=e(this)
a="object"==typeof a?a:{}
var o=void 0===a.value?r.siblings(".deter-password").val():a.value,s=void 0===a.opacity?1:a.opacity,n=void 0===a.sequence?!1:a.sequence,i=void 0===a.canevasSize?"auto":a.canevasSize,b=e.strToColor(o,s,n)
r.identicon(b.md5,b.hex,{rotate:!0,size:i})}),setTimeout(function(){e("div.deter-container.deter-behaviour-box > .deter-password").each(function(){var t=e(this)
""==t.val()&&t.trigger("repaint")})},100)})}(jQuery)