/* deter - version: 3.3 - author: 3ffy (Aur√©lien Gy) - aureliengy@gmail.com - http://www.aureliengy.com - licence: BSD 3-Clause Licence (@see licence file or https://raw.githubusercontent.com/3ffy/deter/master/LICENSE). Note that the plugins "JQuery.Identicon5" by Francis Shanahan (http://archive.plugins.jquery.com/project/identicon5) and "JQuery.MD5" by Gabriele Romanato (http://blog.gabrieleromanato.com) are separated project and get their own licence. */
!function(e){var t=document.createElement("canvas"),r=t.getContext?!0:!1,a={}
a.boxTitle="If this picture is not the one you use to see, your password is misspelled.",a.wrapWithMarkup=function(t,r,a){if("string"!=typeof r)throw"Param 'mode' is mandatory."
"default"==r&&(r="box-identicon"),"string"!=typeof a&&(a=""),$elem=e(t),classbox=" "+a+" deter-mode-"+r,("box-identicon"==r||"box-color"==r)&&(classbox+=" deter-behaviour-box"),$elem.addClass("deter-password").wrap('<div class="deter-container'+classbox+'"></div>'),"body"!=r&&"border"!=r&&"background"!=r&&e('<span class="deter-fingerprint"></span>').insertAfter($elem)}
var o=function(t,r){var a={}
a.md5=e.md5(t),a.hexRaw=a.md5.substr(0,6),a.hex="#"+a.hexRaw,a.rgbRaw=e.hexToRgb(a.hexRaw,!0),a.rgb="rgb("+a.rgbRaw.r+", "+a.rgbRaw.g+", "+a.rgbRaw.b+")"
var o="number"==typeof r?r:1
return a.rgbaRaw=a.rgbRaw,a.rgbaRaw.a=o,a.rgba="rgba("+a.rgbaRaw.r+", "+a.rgbaRaw.g+", "+a.rgbaRaw.b+", "+a.rgbaRaw.a+")",a},s=function(t){var r=t.data,a="function"==typeof r.getContent?r.getContent.call(this):e(this).val(),o=e.strToColor(a,r.opacity,r.sequence)
r.callback.call(this,r,o,a)},n=function(t,r,a){if($elem=e("string"==typeof t.target?t.target:this),""==a)$elem.css("-webkit-box-shadow","").css("-moz-box-shadow","").css("box-shadow","").css("border-color","")
else{var o="inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px "+r.rgba
$elem.css("-webkit-box-shadow",o).css("-moz-box-shadow",o).css("box-shadow",o).css("border-color",r.hex)}},i=function(t,r,a){if($elem=e("string"==typeof t.target?t.target:this),$elem.css("background-color",""==a?"":r.hex),"complementary"==t.textColorMode){var o=e.getComplementaryColor(r.rgbRaw)
$elem.css("color","rgb("+o.r+","+o.g+","+o.b+")")}else if("monochrome"==t.textColorMode){var s=e.getFurtherColor(r.rgbRaw)
$elem.css("color","rgb("+s.r+","+s.g+","+s.b+")")}},b=function(t,r,a){var o=e(this).siblings("span.deter-fingerprint")
o.css("background-color",""==a?"":r.hex)},c=function(t,r,a){var o=e(this).siblings("span.deter-fingerprint")
""==a?o.text(""):o.identicon(r.md5,r.hex,{rotate:!0,size:t.canevasSize})}
e.extend({deter:a,hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i
e=e.replace(t,function(e,t,r,a){return t+t+r+r+a+a})
var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e)
return r?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:null},rgbToXyz:function(e){var t={},r=parseFloat(e.r/255),a=parseFloat(e.g/255),o=parseFloat(e.b/255)
return r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92,a=a>.04045?Math.pow((a+.055)/1.055,2.4):a/12.92,o=o>.04045?Math.pow((o+.055)/1.055,2.4):o/12.92,r=100*r,a=100*a,o=100*o,t.x=.4124*r+.3576*a+.1805*o,t.y=.2126*r+.7152*a+.0722*o,t.z=.0193*r+.1192*a+.9505*o,t},xyzToLab:function(e){var t={},r=e.x/95.047,a=e.y/100,o=e.z/108.883
return r=r>.008856?Math.pow(r,1/3):7.787*r+16/116,a=a>.008856?Math.pow(a,1/3):7.787*a+16/116,o=o>.008856?Math.pow(o,1/3):7.787*o+16/116,t.l=116*a-16,t.a=500*(r-a),t.b=200*(a-o),t},getComplementaryColor:function(e,t){var r={}
return r.r=Math.abs(255-e.r),r.g=Math.abs(1==t?255-(e.r+e.b)/2:255-e.g),r.b=Math.abs(255-e.b),r},getClosestColor:function(t,r,o){"object"!=typeof r&&(rbgcandidate1={r:0,g:0,b:0}),"object"!=typeof o&&(o={r:255,g:255,b:255})
var s=e.rgbToXyz(a.rgbRaw),n=e.xyzToLab(s),i=e.rgbToXyz(r),b=e.xyzToLab(i),c=e.rgbToXyz(o),d=e.xyzToLab(c),l=Math.abs(b.l-n.l)+Math.abs(b.a-n.a)+Math.abs(b.b-n.b),u=Math.abs(d.l-n.l)+Math.abs(d.a-n.a)+Math.abs(d.b-n.b)
return u>=l?r:o},getFurtherColor:function(t,r,a){"object"!=typeof r&&(r={r:0,g:0,b:0}),"object"!=typeof a&&(a={r:255,g:255,b:255})
var o=e.rgbToXyz(t),s=e.xyzToLab(o),n=e.rgbToXyz(r),i=e.xyzToLab(n),b=e.rgbToXyz(a),c=e.xyzToLab(b),d=Math.abs(i.l-s.l)+Math.abs(i.a-s.a)+Math.abs(i.b-s.b),l=Math.abs(c.l-s.l)+Math.abs(c.a-s.a)+Math.abs(c.b-s.b)
return d>l?r:a},strToColor:function(e,t,r){var a
if(r!==!0)a=o(e,t)
else{a=[]
var s,n,i=e.length
for(s=0;i>s;s++)n=e.substr(0,s+1),a.push(o(n,t))}return a}}),e.fn.deter=function(t,a){var o,d=e.extend({sequence:!1,opacity:1,canevasSize:"auto",addDeterExtraMarkups:!0,getContent:null,events:"keyup",selectorDelegated:null,addClass:"",textColorMode:"default",target:null},a)
switch("function"==typeof t?(o="custom",d.sequence=!1):o="string"==typeof t&&"default"!=t?t:"box-identicon","box-identicon"==o&&0==r&&(o="box-color"),null===d.selectorDelegated&&1==d.addDeterExtraMarkups&&e.deter.wrapWithMarkup(this,o,d.addClass),o){case"custom":d.callback=t
break
case"border":d.callback=n
break
case"background":d.callback=i
break
case"box-color":d.callback=b
break
default:d.callback=c}return e(this).on(d.events,d.selectorDelegated,d,s),this},e.fn.identicon=function(t,a,o){if(settings=e.extend({size:65},o),"auto"==settings.size){var s=e(this),n=s.width(),i=s.height()
settings.size=0==n?i:0==i?n:Math.min(n,i)}return this.each(r?function(){var r=e(this)
"string"==typeof t?r.text(t).identicon5(settings):r.text("")}:function(){var r=e(this)
if("string"==typeof t){var o=r.html('<span class="deter-fake-canevas"></span>')
o.css("width",settings.size).css("height",settings.size).css("background-color",a)}else r.text("")}),this},e(document).ready(function(){e("body").on("click","div.deter-container.deter-behaviour-box",function(){var t=e(this).children(".deter-password")
t.focus()}).on("focus","div.deter-container.deter-behaviour-box > .deter-password",function(){if(""!=e(this).val()){var t=e(this).parent("div.deter-container.deter-behaviour-box")
t.addClass("focused")}}).on("blur","div.deter-container.deter-behaviour-box > .deter-password",function(){var t=e(this).parent("div.deter-container.deter-behaviour-box")
t.removeClass("focused")}).on("keyup","div.deter-container.deter-behaviour-box > .deter-password",function(){var t=e(this).parent("div.deter-container.deter-behaviour-box"),r=e(this).siblings("span.deter-fingerprint")
""!=e(this).val()?(t.addClass("focused"),r.addClass("visible").attr("title",e.deter.boxTitle)):(t.removeClass("focused"),r.removeClass("visible").removeAttr("title"))}).on("repaint","div.deter-container.deter-mode-box-identicon > .deter-password",function(t,r){e(this).siblings(".deter-fingerprint").trigger("repaint",r)}).on("repaint",".deter-fingerprint",function(t,r){var a=e(this)
r="object"==typeof r?r:{}
var o=void 0===r.value?a.siblings(".deter-password").val():r.value,s=void 0===r.opacity?1:r.opacity,n=void 0===r.sequence?!1:r.sequence,i=void 0===r.canevasSize?"auto":r.canevasSize,b=e.strToColor(o,s,n)
a.identicon(b.md5,b.hex,{rotate:!0,size:i})}),setTimeout(function(){e("div.deter-container.deter-behaviour-box > .deter-password").trigger("repaint")},100)})}(jQuery)